\documentclass[11pt]{article}
\usepackage{fullpage}
\usepackage{amsthm}

\usepackage{amsthm,amsmath,amsfonts,amssymb,amstext,enumitem}
\usepackage{latexsym,ifthen,url,rotating,graphicx}
\usepackage{listings}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes,positioning,fit}
\usepackage{graphicx}
\usepackage[font=small,labelfont=bf]{caption}



% --- -----------------------------------------------------------------
% --- Document-specific definitions.
% --- -----------------------------------------------------------------
\lstset{
    columns=fixed,
    literate={—}{{---}}1 {…}{{...}}1
}

\newcommand{\todo}[1]{{\color{red}[TODO:{#1}]}}

\newtheorem{problem}{Problem}
\newtheorem{corollary}{Corollary}
\newtheorem{fact}{Fact}
\newtheorem{exercise}{Exercise}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}
\newtheorem{notation}{Notation}
\newtheorem{lemma}{Lemma}
\newtheorem{example}{Example}

\newcommand{\getsr}
  {{\:\stackrel{\raisebox{-2pt}{${\scriptscriptstyle \hspace{0.2em}\$}$}}
   {\leftarrow}\:}}
\newcommand{\points}[1]{\textbf{({#1} pts)}}

\newcommand{\Colon}{\ : \ }
\newcommand{\st}{\mathsf{state}}
\newcommand{\msgs}{\mathcal{M}}
\newcommand{\ctxts}{\mathcal{C}}
\newcommand{\keys}{\mathcal{K}}
\newcommand{\kg}{\mathcal{K}}
\newcommand{\enc}{E}
\newcommand{\dec}{E^{-1}}
\newcommand{\MAC}{\mathrm{MAC}}
\newcommand{\RMAC}{\mathrm{RMAC}}

\newcommand{\pk}{pk}
\newcommand{\sk}{sk}

\newcommand{\AES}{\mathsf{AES}}

\newcommand{\algorithm}[1]{\textbf{Alg} {#1}}

\newcommand{\calO}{\mathcal{O}}

\newcommand{\dlog}{\mathrm{dlog}}

\newcommand{\Adv}{\mathbf{Adv}}
\newcommand{\AdvPRF}[2]{\Adv^{\mathrm{prf}}_{#1}({#2})}
\newcommand{\AdvCPA}[2]{\Adv^{\mathrm{ind{-}cpa}}_{#1}({#2})}
\newcommand{\AdvCCA}[2]{\Adv^{\mathrm{ind{-}cca}}_{#1}({#2})}
\newcommand{\AdvKR}[2]{\Adv^{\mathrm{kr}}_{#1}({#2})}
\newcommand{\AdvCKR}[2]{\Adv^{\mathrm{ckr}}_{#1}({#2})}
\newcommand{\AdvRMR}[2]{\Adv^{\mathrm{rmr}}_{#1}({#2})}
\newcommand{\AdvCR}[2]{\Adv^{\mathrm{cr}}_{#1}({#2})}
\newcommand{\AdvUFCMA}[2]{\Adv^{\textrm{uf{-}cma}}_{#1}({#2})}
\newcommand{\AdvDL}[2]{\Adv^{\mathrm{dl}}_{#1}({#2})}

\newcommand{\Exp}{\mathbf{Exp}}
\newcommand{\ExpOW}[1]{\Exp^{\mathrm{ow}}({#1})}
\newcommand{\ExpCKR}[2]{\Exp^{\mathrm{ckr}}_{#1}({#2})}
\newcommand{\ExpRMR}[2]{\Exp^{\mathrm{rmr}}_{#1}({#2})}

\newcommand{\concat}{{\,\|\,}}
\newcommand{\xor}{\oplus}
\newcommand{\bits}{\{0,1\}}

\newcommand{\tcolh}{T^{\mathrm{col}}_h}
\newcommand{\tcolH}{T^{\mathrm{col}}_{H^2}}
\newcommand{\Hcomb}{H^{1\|2}}
\newcommand{\Hxor}{H^{1\oplus2}}

\newcommand{\EXP}{\textrm{EXP}}
\newcommand{\MODEXP}{\textrm{MOD{-}EXP}}
\newcommand{\ADD}{\textrm{ADD}}
\newcommand{\MULTIMODEXP}{\textrm{MULTI{-}MOD{-}EXP}}
\newcommand{\MUL}{\textrm{MUL}}
\newcommand{\MOD}{\textrm{MOD}}

\newcommand{\GG}{\mathbb{G}}
\newcommand{\ZZ}{\mathbb{Z}}

\newcommand{\bK}{\mathbf{K}}
\newcommand{\bM}{\mathbf{M}}
\newcommand{\bC}{\mathbf{C}}

\newcommand{\rvrange}{\mathcal{R}}
\newcommand{\rspace}{\mathcal{C}}

\newcommand{\hatalpha}{\hat{\alpha}}

\newcommand{\otp}{\mathrm{OTP}}

% --- -----------------------------------------------------------------
% --- Lecture notes formatting macros
% --- -----------------------------------------------------------------

%
% The following commands set up the lecnum (lecture number)
% counter and make various numbering schemes work relative
% to the lecture number.
%
\newcounter{lecnum}
%\renewcommand{\thepage}{\thelecnum-\arabic{page}}
\renewcommand{\thesection}{\thelecnum.\arabic{section}}
\renewcommand{\theexercise}{\thelecnum.\arabic{exercise}}
\renewcommand{\theexample}{\thelecnum.\arabic{example}}
\renewcommand{\thedefinition}{\thelecnum.\arabic{definition}}
\renewcommand{\theequation}{\thelecnum.\arabic{equation}}
\renewcommand{\thefigure}{\thelecnum.\arabic{figure}}
\renewcommand{\thefact}{\thelecnum.\arabic{fact}}
\renewcommand{\thetable}{\thelecnum.\arabic{table}}


%
% The following macro is used to generate the header.
%
\newcommand{\lecture}[2]{
   %\pagestyle{myheadings}
   %\thispagestyle{plain}
   \newpage
   \setcounter{lecnum}{#1}
   \setcounter{page}{1}
   \noindent
   \begin{center}
   \framebox{
      \vbox{\vspace{2mm}
    \hbox to 6.28in { {\bf CMSC 28400 Introduction to Cryptography
                        \hfill Autumn 2019} }
       \vspace{4mm}
       \hbox to 6.28in { {\Large \hfill #2 \hfill} }
       \vspace{2mm}
       \hbox to 6.28in { {\it Instructor: David Cash} \hfill }
      \vspace{2mm}}
   }
   \end{center}
   %\markboth{Lecture #1: #2}{Lecture #1: #2}
   \vspace*{4mm}
}





% --- -----------------------------------------------------------------
% --- The document starts here.
% --- -----------------------------------------------------------------
\begin{document}
%\lecture{**LECTURE-NUMBER**}{**DATE**}{**LECTURER**}{**SCRIBE**}
\lecture{3}{Notes \#3: Perfect Secrecy}

\tableofcontents

\noindent\hrulefill
\bigskip


These notes cover our first definition of security: \emph{Perfect Secrecy},
which dates back to the work Shannon in the 1950s.

\section{Ciphers and Perfect Secrecy}

First let's recall the definition of a cipher from earlier.
\begin{definition}
    Let $\keys,\msgs,\ctxts$ be non-empty sets. A function
    \[
        \enc : \keys\times\msgs \to \ctxts
    \]
    is called a \emph{cipher with key-space $\keys$, message-space
    $\msgs$, and ciphertext-space $\ctxts$} if for every $K\in\keys$,
    the function $\enc(K,\cdot)$ is one-to-one.

    For such a cipher, we define 
    \[
        \dec: \keys\times\ctxts \to\msgs
    \]
    by letting $\dec(K,\cdot)$ be the inverse of $\enc(K,\cdot)$ for
    each $K\in\keys$. (More precisely, $\dec(k,c)$ is only defined when
    there exits $m\in\msgs$ such that $\enc(k,m)=c$.)
\end{definition}

Suppose $E$ is a cipher. What does it mean for $E$ to be secure? We could come
up with list of attacks that it should resist, or we could ask more abstractly
that ``no one should be able to recover an encrypted message'', or even ``no
one should be able to recover any part of an encrypted message''.

The approach to answering this question taken next subsection is to give
a mathematical definition of security which compresses a long list of
security properties into one simple requirement.

\subsection{The Definition of Perfect Secrecy}

Here's the definition:
\begin{definition}Let $\enc : \keys\times\msgs \to \ctxts$ be a cipher and
    $\bK$ be a uniform random variable on $\keys$.  We say that $\enc$ is
    \emph{perfectly secret} if for all $m_1,m_2\in\msgs$, and $c\in\ctxts$,
    \[
        \Pr[\enc(\bK,m_0) = c] = \Pr[\enc(\bK,m_1) = c].
    \]
\end{definition}
In the probabilities, $\bK$ is the only random variable. So for instance
the left probability is determined by how often $m_0$ will encrypt to
$c$ with a randomly-chosen key; The other probability is the same except
with $m_1$. But in both probabilities, $m_0,m_1$, and $c$ are \emph{fixed}
and not random.

Intuitively, this definition says that which message you are encrypting
should not affect the distribution of the ciphertext you get. This is great
for security, because it means an attacker looking at the ciphertext gets
``no information'' about what the message was.

\begin{exercise}
    Show that the substitution cipher is not perfectly secret.  (Hint:
    Considering a ciphertext like $c=\mathtt{AA}$ makes this more clear, but
    any ciphertext will work.)
\end{exercise}


The following definition is somewhat more complicated technically, but may
be more clear. It is equivalent to perfectly secrecy.
\begin{definition} 
    Let $\enc : \keys\times\msgs \to \ctxts$ be a cipher and $\bK$ be a uniform
    random variable on $\keys$.  We say that $\enc$ has \emph{independent
    ciphertexts} if for all random variables $\bM$ on $\msgs$ independent of
    $\bK$, we have that the random variable $\bC = \enc(\bK,\bM)$ is
    independent of $\bM$.
\end{definition}
Here we use a random variable $\bM$ to model picking a message
in some application-dependent way (or to model the distribution of the message
given an attacker's knowledge). For instance, if an attacker knows you
sending a payment response to a website, it might know every character of your
message except your credit card number. In that case $\bM$ could be a fixed
request but with random digits for the credit card number.


\begin{theorem}
    A cipher $\enc : \keys\times\msgs \to \ctxts$ is perfectly secret
    if and only if it has independent ciphertexts.
\end{theorem}

\begin{exercise}
    Prove this theorem. (Hint: There are two directions. You will need
    to look up the precise definition of independent random variables
    if you are unsure how to proceed rigorously.)
\end{exercise}

\section{The One-Time Pad is Perfectly Secret}

For each integer $n\geq 1$, define the cipher $\otp_n : \bits^n\to\bits^n \to
\bits^n$ by
\[
    \otp_n(k,m) = k \oplus m.
\]
These ciphers are perfectly secret, as we now prove.
\begin{theorem}
    For every integer $n\geq 1$, the cipher $\otp_n$ is perfectly secret.
\end{theorem}
\begin{proof} We use original definition, so we have to show that for every
    $m_0,m_1\in\bits^n$ and $c\in\bits^n$,
    \[
        \Pr[\enc(\bK,m_0) = c] = \Pr[\enc(\bK,m_1) = c],
    \]
    where $\bK$ is uniform on $\bits^n$.  We will do even better, and show that
    for every $m\in\bits^n$, $\Pr[\enc(\bK,m) = c] = 2^{-n}$, which will
    imply what we need. This follows because
    \[
        \Pr[\enc(\bK,m) = c] = \Pr[\bK\oplus m=c] = \Pr[\bK=c\oplus m] = 2^{-n}.
    \]
    The first two equalities hold because $\enc(\bK,m)=c$, $\bK\oplus m = c$,
    and $\bK=c\oplus m$ are all the same event (one happens if and only if the
    others happen). The last equality holds because $\bK$ is uniform and
    $c\oplus m$ is just a fixed element of $\bits^n$.
\end{proof}
As short as it is, this proof might be tricky if you are not used to
manipulating random variables. It is worth referring back to the probability
background if you found the equalities in the proof difficult to verify.

This theorem explains why we needed to have multiple encryptions under the same
key in order to break a one-time pad cipher: If we only had one ciphertext,
then we'd effectively have only a random string, independent of the message.
But once more than one ciphertext with the same key is available, attacks like
crib-dragging are effective.

\begin{exercise}
    Define a version of the Vigen\`{e}re cipher with an $n$-letter
    key working only on ciphertexts of $n$ letters. Show that this
    cipher is perfectly secret.
\end{exercise}

\begin{exercise}
    Define a cipher $E:\bits\times\{0,1,2\}\to\{0,1,2\}$ by $E(k,m) = k+m\bmod
    3$. Show directly that $E$ is not perfectly secret. (This will also be a
    consequence of a later theorem.)
\end{exercise}


\section{Perfectly Secret Ciphers Must Have $|\keys| \geq |\msgs|$}

The $n$-bit one-time pad has key as long as the messages, which is inconvenient
when messages are long. The following theorem shows this is in some sense
unavoidable when one insists of having a perfectly secret cipher.
\begin{theorem}
    A cipher $\enc : \keys\times\msgs \to \ctxts$ is perfectly secret
    if and only if it has independent ciphertexts.
\end{theorem}
\begin{proof}
    We prove the contrapositive, meaning we show that if $|\keys| < |\msgs|$,
    then $E$ is not perfectly secret. In order to show $E$ is not perfectly
    secret, we find some $m_0,m_1\in\msgs$ and $c\in\ctxts$ such that
    \begin{align}\label{neqprob}
        \Pr[\enc(\bK,m_0) = c] \neq \Pr[\enc(\bK,m_1) = c],
    \end{align}
    where $\bK$ is uniform on $\keys$.

    We start by taking $c\in\ctxts$ to be an arbitrary element of the image of
    $E$ (so, we know that $E(k,m)=c$ for some $k\in\keys,m\in\msgs$, but we
    don't care how its picked beyond that).

    Define the set $X$ of ``all possible decryptions of $c$'' as
    \[
        X = \{E^{-1}(k,c) \ | \ k\in\keys \}.
    \]
    Notice that $|X| \leq |\keys|$, because at most one element is added to $X$
    per element of $\keys$ (it might be less because we might add the same
    element twice). By our choice of $c$ we also have that $X$ is non-empty;
    pick some arbitrary $m_1\in X$.

    Since $|X| \leq |\keys|$, and we assumed $|\keys| < |\msgs|$, we have
    $|X| \leq |\msgs|$. Therefore $X$ does not contain all of $\msgs$, and
    can choose some $m_0 \in \msgs$ that is not in $X$.
    The following diagram shows the relationship between $c,m_1$ and $m_0$.
    \begin{center}
        \begin{tikzpicture}
            \tikzstyle{connect}=[circle, draw, thin,fill=black, scale=0.4]
            \tikzstyle{every path}=[thick]
            \tikzstyle{rotor}=[very thick, rounded corners]
            \tikzstyle{input}=[circle,draw,scale=.7]
            \tikzstyle{internalwire}=[thick,darkgray]

            \node[connect] (m1) {};
            \node[connect, below=.2cm of m1] (m2) {};
            \node[below=-.1cm of m2] (dots) {$\vdots$};
            \node[connect, below=.05cm of dots] (m3) {};
            \node[below=.05cm of m3] (m3label) {$m_1$};
            \node[shape=ellipse,draw,fit={(m1) (m3label)}] (X) {};
            \node[below=-.1cm of X] (Xlabel) {$X$};

            \node[connect, below=.4cm of Xlabel] (m0) {};
            \node[below=.05cm of m0] (m0label) {$m_0$};

            \node[shape=ellipse,draw,minimum width=1.5cm,fit={(X) (m0label)}] (msgs) {};
            \node[below=.1cm of msgs] {$\msgs$};

            \node[connect, right=3cm of m1] (c) {};
            \node[below=.05cm of c] (clabel) {$c$};
            \node[right=3cm of Xlabel] (cinvis) {};
            \node[shape=ellipse,draw,minimum width=1cm,fit={(c) (cinvis)}] (ctxts) {};
            \node[below=.1cm of ctxts] {$\ctxts$};

            \draw [->] (c) -- (m1);
            \draw [->] (c) -- (m2);
            \node[right=1.2cm of m2] {$\vdots$};
            \draw [->] (c) -- (m3);

        \end{tikzpicture}
    \end{center}
    We have chosen our $m_0,m_1$, and $c$. It remains to verify that
    (\ref{neqprob}) holds. This follows by two observations:
    \begin{itemize}
        \item $\Pr[E(\bK,m_0)=c] = 0$, because there is no key $k$ such
            that $E(k,m_0)=c$.
        \item $\Pr[E(\bK,m_1)=c] \geq 1/|\keys| > 0$, because there
            is at least one key $k$ such that $E(k,m_1)=c$.
    \end{itemize}
    This shows the probabilities are not equal and completes the proof.
\end{proof}
\end{document}

